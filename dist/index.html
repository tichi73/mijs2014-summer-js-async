<!DOCTYPE html lang="ja">
<html>
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>MIJS 2014 夏合宿</title>
    <link rel="stylesheet" href="lib/html5reset-1.6.1.css">
    <link rel="stylesheet" href="lib/bootstrap-3.2.0-dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/demo.min.css">
    <script src="lib/jquery-1.11.1.min.js"></script>
    <script src="lib/bootstrap-3.2.0-dist/js/bootstrap.min.js"></script>
    <script src="js/demo.min.js"></script>
    <script src="//localhost:35729/livereload.js"></script>
</head>
<body>

<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
<div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="#">MIJS 夏の日の 2014</a>
    </div>
</div>
</nav>

<div class="page-header">
<h1>JavaScript / jQuery 班 <small>非同期処理サブチーム</small></h1>
</div>

<div class="panel-group" id="accordion">
  <div class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" data-parent="#accordion" href="#demo-panel1">
        非同期デモ #1      </a>
    </h4>
  </div>
  <div id="demo-panel1" class="panel-collapse collapse">
    <div class="panel-body">
      <button class="btn btn-primary"><span class="glyphicon glyphicon-play"></span> 実行</button>
      <div class="panel-content">
        <script type="text/javascript">
!function(){
	var panel = $("#demo-panel1");
	var timeout = 5000;
	var btn = panel.find('.btn.btn-primary');
	var content = panel.find('.panel-content');	

	btn.click(function(){
		btn.prop('disabled', true);
		content.text("実行ボタンが押されました... ");
		setTimeout(function(){
			content.text(content.text() + timeout + "ms経過...Done!");
			btn.prop('disabled', false);
		}, timeout);
	});
}();
</script>
      </div>
    </div>
  </div>
</div>
  <div class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" data-parent="#accordion" href="#demo-panel2">
        非同期デモ #2      </a>
    </h4>
  </div>
  <div id="demo-panel2" class="panel-collapse collapse">
    <div class="panel-body">
      <button class="btn btn-primary"><span class="glyphicon glyphicon-play"></span> 実行</button>
      <div class="panel-content">
        <script type="text/javascript">
!function(){
	var panel = $("#demo-panel2");
	var timeout = 5000;
	var btn = panel.find('.btn.btn-primary');
	var content = panel.find('.panel-content');

	function delay(callback) {
		setTimeout(function(){
			content.text(content.text() + timeout + "ms経過... ");
			callback();
		}, timeout);
	}

	btn.click(function(){
		btn.prop('disabled', true);
		content.text("実行ボタンが押されました... ")
		delay(function(){
			delay(function(){
				delay(function(){
					content.text(content.text() + "完了!");
					btn.prop('disabled', false);
				})
			})
		});
	});
}();
</script>
      </div>
    </div>
  </div>
</div>
  <div class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      <a data-toggle="collapse" data-parent="#accordion" href="#demo-panel3">
        非同期デモ #3      </a>
    </h4>
  </div>
  <div id="demo-panel3" class="panel-collapse collapse">
    <div class="panel-body">
      <button class="btn btn-primary"><span class="glyphicon glyphicon-play"></span> 実行</button>
      <div class="panel-content">
        <script type="text/javascript">
!function(){
	var panel = $("#demo-panel3");
	var timeout = 5000;
	var btn = panel.find('.btn.btn-primary');
	var content = panel.find('.panel-content');	

	function delay() {
		/* Deferred オブジェクトを生成する */
		var deferred = new $.Deferred;
		setTimeout(function(){
			content.text(content.text() + timeout + "ms経過... ");
			/* 非同期処理が完了したときに resolve() を呼び出す */
			deferred.resolve();
		}, timeout);
		/* Deferred の Promise オブジェクトを返す */
		return deferred.promise();
	}

	btn.click(function(){
		btn.prop('disabled', true);
		content.text("実行ボタンが押されました... ")
		delay()
		.then(delay)
		.then(delay)
		.then(function(){
			content.text(content.text() + "完了!");
			btn.prop('disabled', false);
		});

	});
}();
</script>
      </div>
    </div>
  </div>
</div>
</div>

<!-- Scripts -->
</body>
</html>